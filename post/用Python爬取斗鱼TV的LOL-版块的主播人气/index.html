
<!DOCTYPE html>
<html lang="zh-CN">
<head>
 <meta name="viewport" content="width=device-width, initial-scale=1" />
<meta HTTP-EQUIV="pragma" CONTENT="no-cache"> 
<meta HTTP-EQUIV="Cache-Control" CONTENT="no-cache, must-revalidate"> 
<meta HTTP-EQUIV="expires" CONTENT="0"> 
<title>用Python爬取斗鱼TV-LOL版块的主播人气 | Tudouvvv</title>	

<link rel="stylesheet" href="https://tudouvvv.github.io//styles/main.css">
<script type="text/javascript">
function getCSS(){datetoday=new Date();timenow=datetoday.getTime();datetoday.setTime(timenow);thehour=datetoday.getHours();if(thehour<20)display="https://tudouvvv.github.io//media/scripts/dark.css";else if(thehour>8)display="https://tudouvvv.github.io//media/scripts/dark.css";var css='<';css+='link rel="stylesheet" href='+display+' \/';css+='>';document.write(css)}
</script>
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<script type='text/javascript' src='https://tudouvvv.github.io//media/scripts/script.js'></script>
<link href="https://cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet" />
  <script src="https://cdn.bootcss.com/wow/1.1.2/wow.min.js"></script>
  <script src="https://cdn.bootcss.com/highlight.js/9.15.8/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <script>wow=new WOW({boxClass:'wow',animateClass:'animated',offset:0,mobile:true,live:true});wow.init();</script>




 	
</head>
<body class="post-template-default single single-post postid-70 single-format-standard">
    <div id="wrapper">
        
			
		<header id="header" class="site-header" 
		
		style="background-image:url(https://raw.githubusercontent.com/Tudouvvv/Pic_path/master/2018-03-18-banner.jpg)"
		
		>
			<div class="site-branding">
									<h1 class="site-title"><a href="https://tudouvvv.github.io/" rel="home">Tudouvvv</a></h1>
										
					<h2 class="site-description">人生还长，慢慢来</h2>
										
							</div>
			<nav id="nav-wrapper">
				<div class="container">
					<div class="nav-toggle">
						<div class="bars">
							<div class="bar"></div>
							<div class="bar"></div>
							<div class="bar"></div>
						</div>
					</div><!-- /nav-toggle -->
					<div class="clear"></div>
					<ul id="" class="dove">
		 
     			
<li>
	 
	<a  href="/"> 首页</a></li>
	
    
     			
<li>
	 
	<a  href="/archives"> 归档</a></li>
	
    
     			
<li>
	 
	<a  href="/tags"> 标签</a></li>
	
    
     			
<li>
	 
	<a  href="/post/about"> 关于</a></li>
	
    

</ul>
</li>		
		
</ul>				</div>
			</nav><!-- #navigation -->
						<div class="jingge">


    

    
			
<a  href="https://github.com/tudouvvv" target="_blank" ><i class="iconfont icon-github"></i></a>
 
    

    

    

    

    

    
			
<a  href="https://www.instagram.com/gu_lo__/" target="_blank" ><i class="iconfont icon-instagram"></i></a>
 
    

    
			
<a  href="https://weibo.com/u/3037316034" target="_blank" ><i class="iconfont icon-weibo"></i></a>
 
    

    
        </header><!-- #masthead -->

		<div id="content" class="container">
			<div class="row">
	<div class="col-md-8 site-main">
				
<article id="post-70" class="post-70 post type-post status-publish format-standard hentry category-5 tag-10 tag-9 tag-11">

	
	                      
		<div class="entry-content">
			<h1 class="wow swing entry-title">用Python爬取斗鱼TV-LOL版块的主播人气</h1>
<div class="entry-meta">
<div class="wow bounce">
	<i class="iconfont icon-rili"> <time class="lately-a" datetime="2018-03-18 22:35:11" itemprop="datePublished" pubdate="">2018-03-18</time></i>
	          </div>
			
</span>
													 
		</div>
                  
			<div class="wow slideInLeft entry-summary song">
				<p><p>刚好学完这个，就拿来练一练手Σ(っ °Д °;)っ</p>
<p>觉得爬虫最重要的还是要理清思路，先爬什么，然后怎么筛选，我们想要输出怎样的格式...</p>
<p>然后就是最重要的正则表达式了，至少我现在用的就是这个，至于各种爬虫框架还要继续学习，刚开始爬斗鱼的时候，竟然弹出403错误，本来都想换熊猫了，结果过了一会儿就好了 - - 不知道为什么</p>
<p>还有，现在还没有学习关于数据库的知识，不知道怎么储存爬下来的数据，也只会爬取首页(lll￢ω￢)</p>
<p>慢慢来吧，接下来这一周要出去找调剂了，希望有个好结果吧，不过我觉得非全也比错φ(゜▽゜*)♪，等一切都结束可以写一篇记录考研的文章，嘎巴得！</p>
<pre><code class="language-python">import re
from urllib import request

class Spider():
    url = 'https://www.douyu.com/directory/game/LOL'
    root_pattern = '&lt;p&gt;([\s\S]*?)&lt;/p&gt;'
    name_pattern = '&lt;span class=&quot;dy-name ellipsis fl&quot;&gt;([\s\S]*?)&lt;/span&gt;'
    number_pattern = '&lt;span class=&quot;dy-num fr&quot;  &gt;([\s\S]*?)&lt;/span&gt;'

    def __fetch_content(self):
        r = request.urlopen(Spider.url)
        htmls = r.read()
        htmls = str(htmls,encoding = 'utf-8')
        return htmls

    def __analisis(self,htmls):
        root_html = re.findall(Spider.root_pattern,htmls)
        anchors = []
        for html in root_html:
            name = re.findall(Spider.name_pattern,html)
            number = re.findall(Spider.number_pattern,html)
            anchor = {'name':name,'number':number}
            anchors.append(anchor)
        return anchors

    def __refine(self,anchors):
        l = lambda anchor: {
            'name':anchor['name'][0],
            'number':anchor['number'][0]}
        return map(l,anchors)

    def __sort(self,anchors):
        anchors = sorted(anchors,key=self.__sort_seed,reverse=True)
        return anchors

    def __sort_seed(self,anchor):
        r = re.findall('\d*',anchor['number'])
        number = float(r[0])
        if '万' in anchor['number']:
            number*=10000
        return number

    def __show(self,anchors):
        for anchor in anchors:
            print(anchor['name']+ '-----' + anchor['number']+'人')
    
    def go(self):
        htmls = self.__fetch_content()
        anchors = self.__analisis(htmls)
        anchors = list(self.__refine(anchors))
        anchors = self.__sort(anchors)
        self.__show(anchors)

spider = Spider()
spider.go()
</code></pre>
<p>只爬取了一页，因为我还不知道怎么爬取多页- -</p>
<pre><code>爬取结果：（2018/3/18  22：52）

英雄联盟官方赛事-----130万人
东北大鹌鹑-----127万人
冯提莫-----115万人
洞主丨歌神洞庭湖-----46.6万人
叫我久哥哥-----25.8万人
叶音符-----19.7万人
赏金术士2018-----14.2万人
小子y-----12.3万人
三笠ackerman丶1-----10.7万人
胖胖灬-----10.5万人
余小C真的很强-----10.2万人
lol大表哥丶-----9.2万人
黑白锐雯-----8.3万人
LoveAcFun包子-----8.1万人
心态很不好的momo-----7.4万人
14德莱文-----7.2万人
你的大湿胸丶-----5.7万人
教练JoKer-----5.5万人
凉风亚索yasuo-----4.7万人
冷爷行妹-----4.6万人
狗康Bfate丶-----3.8万人
跳跳武器二师兄-----3.5万人
熙宝兒-----3.3万人
一拳超人King丶-----3.2万人
解小亮-----3万人
douyu丶松子-----3万人
Tumi111-----2.9万人
Douyu若雨-----2.8万人
林瑜有鱼aa-----2.5万人
暴风工作室丶-----2.4万人
小熊和你-----1.9万人
成都二傻子丶骚特-----1.8万人
芜湖灬王导-----1.8万人
青蛙ob-----1.8万人
张海彬丶-----1.6万人
作作金克丝-----1.6万人
泰迪日了哈士奇-----1.5万人
西关龙-----1.5万人
内涵段子丶朵朵-----1.5万人
羽毛发条丶31969-----1.5万人
小祖zmy-----1.5万人
特工小琪琪-----1.4万人
我有一条小尾巴吖-----1.4万人
乌鸦c丶叫我大马哥-----1.3万人
污妖王丶扎男-----1.3万人
老实巴交的残梦-----1.3万人
土豆女王驾到-----1.3万人
小丫头丶乖乖-----1.2万人
刘刘刘毛豆-----1.2万人
叫我Keep哥-----1.2万人
叫我天神x-----1.2万人
国服第一洛冷眸-----1.2万人
西瓜酱G-----1.2万人
许悟空Goku-----1.1万人
你也可以叫我花仔啊-----1.1万人
凌飞Sniperking-----1.1万人
海浪摄长-----1.1万人
渝万丶阿哲-----1.1万人
尔雅超星服务中心-----1.1万人
qq_s6oI4T-----1万人
内涵段子丶渣渣涛-----1万人
吃货丶权爷-----1万人
一只奶酪啊-----1万人
二哈蛮王-----9889人
傲娇筱筱灬-----9875人
屠殺-----9590人
像最初ch-----9485人
娇羞的糖糖啦-----9095人
烁烁and小炮-----8821人
美少女秀秀-----8709人
陈陈陈陈港-----8412人
小崔丶xc-----8374人
zz小龙男枪c-----8300人
Eliza丶梓淇-----8176人
渝万丶小棉花-----8102人
辉哥飞呀挥-----8031人
粉红AD契约喵-----7928人
铁头乌迪尔-----7898人
小诸葛Zz-----7873人
小红集团丶红茶-----7858人
叶晚r-----7858人
肥螳螂老无名-----7830人
寻练-----7792人
会翻滚的阿冰-----7476人
主播丶C罗-----7136人
静儿家的苏麻瓜-----7087人
国服第一小鸡雞-----7034人
659019丶Lux峰-----6956人
三岁喵Meow-----6922人
天才小橙汁-----6848人
偷人大叔玩安妮-----6816人
mm丶小小酥-----6798人
NaiDiiiiii-----6792人
我就是蘑菇阿i-----6528人
中年人的钻石梦-----6451人
杨少爷与黄公子-----6373人
宅兔兔-----6364人
田间一牧牛小童-----6355人
杀神红名-----6205人
丑角乌拉拉-----6185人
小生不才丶y-----6106人
渝万丶阿新哥-----6024人
赛事专用直播间-----5982人
开水铺阿亮-----5970人
nu儿哈哈哈-----5936人
美腻哈-----5878人
青岛声优娜阿-----5785人
丶小雪兔儿-----5763人
</code></pre>
</p>
							</div>
	<div class="wow bounceInDown vt-post-tags">
 
				<a href="https://tudouvvv.github.io//tag/python" rel="tag">Python</a>	
				 
				<a href="https://tudouvvv.github.io//tag/code" rel="tag">Code</a>	
				 
					</div>						
<nav class="navigation3 post-navigation3" role="navigation">
		
		<div class="nav-links3">
      
		<div class="wow bounceInLeft nav-previous3"><a href="https://tudouvvv.github.io//post/Python学习之路" rel="prev"> Python学习日记</a></div>
		 
		 
		<div class="wow bounceInRight nav-next3"><a href="https://tudouvvv.github.io//post/终于完成了" rel="next"> 终于完成了φ(゜▽゜*)♪</a></div>
		
		</div>
	</nav>
	<div class="wow rollIn author-info" style="visibility: visible; animation-name: rollIn;">
	<div class="author-avatar pull-left"><img src="https://tudouvvv.github.io//images/avatar.png" ></div>
 
	<div class="author-description"><div class="author-title"><div class="author-link" rel="author">Tudouvvv</div></div>


	<p class="author-bio">fighting！！！</p></div></div>
	
		</div>
		
 
		
</article>

<div id="marlin_lite_about_widget-2" class="wow bounceInUp widget marlin_lite_about_widget" data-wow-delay="0.1s">
		
        
		<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='https://tudouvvv.github.io//media/scripts/Valine.min.js'></script>

<div class="comment"></div>
<script>
        new Valine({
            // AV 对象来自上面引入av-min.js(老司机们不要开车➳♡゛扎心了老铁)
            av: AV, 
            el: '.comment',
            lang: 'zh-cn',
            
            admin_email:'269995137@qq.com',
            
            
            emoticon_url: 'output/alu',
             
      emoticon_list: ["吐.png","喷血.png","狂汗.png","不说话.png","汗.png","坐等.png","献花.png","不高兴.png","中刀.png","害羞.png","皱眉.png","小眼睛.png","中指.png","尴尬.png","瞅你.png","想一想.png","中枪.png","得意.png","肿包.png","扇耳光.png","亲亲.png","惊喜.png","脸红.png","无所谓.png","便便.png","愤怒.png","蜡烛.png","献黄瓜.png","内伤.png","投降.png","观察.png","看不见.png","击掌.png","抠鼻.png","邪恶.png","看热闹.png","口水.png","抽烟.png","锁眉.png","装大款.png","吐舌.png","无奈.png","长草.png","赞一个.png","呲牙.png","无语.png","阴暗.png","不出所料.png","咽气.png","期待.png","高兴.png","吐血倒地.png","哭泣.png","欢呼.png","黑线.png","喜极而泣.png","喷水.png","深思.png","鼓掌.png","暗地观察.png"],
     
      app_id: 'OCUFvf1hIOEPVaYh87pSozz6-MdYXbMMI',
      	
      
      app_key: 'uPz5zstgqjnR3QQKS5g9rdIw',
         	
          
        });
    </script> 


   
  
 

		</div>

			</div>
			


<div class="tocc col l3 hide-on-med-and-down">
	
        <div class="toc-widget">
			
            <div class="toc-title"></div>
			
            <div id="toc-content">
			
			
			</div>
        </div>
    </div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.5.0/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '.entry-summary',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('.entry-summary').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });
    });
</script>										 

 
       


			</div>
		</div>

		
		 	<footer id="colophon" class="site-footer">

			<div class="container">
	
				<div class="copyright">COPYRIGHT © 2019 <a href="https://miracol.cn/" target="_blank">MIRACOL</a>
Produced by <a href="https://github.com/tudouvvv" target="_blank">Tudouvvv</a><br>Theme:   <a href="https://github.com/alterfang/gridea-theme-pan" target="_blank" title="Pan"><span>Pan</span></a>. Powered by <a href="https://gridea.dev/" target="_blank" title="Gridea"><span>Gridea</span></a></div>		
			</div><!-- .container -->
		
		</footer><!-- #colophon -->

</div>

<script src="https://cdn.bootcss.com/fitvids/1.2.0/jquery.fitvids.min.js"></script>
<script type='text/javascript' src='https://tudouvvv.github.io//media/scripts/marlin-scripts.js'></script>
 <script src="//tokinx.github.io/lately/lately.min.js"></script>
  <script>jQuery(document).ready(function(){$.lately({'target':'.lately-a,.lately-b,.lately-c'})});</script>
  <style type="text/css">a.back_to_top {
    text-decoration: none;
    position: fixed;
    bottom: 40px;
    right: 30px;
    background: #f0f0f0;
    height: 40px;
    width: 40px;
    border-radius: 50%;
    line-height: 36px;
    font-size: 18px;
    text-align: center;
    transition-duration: .5s;
    transition-propety: background-color;
    display: none;
}

a.back_to_top span {
    color: #888;
}

a.back_to_top:hover {
    cursor: pointer;
    background: #dfdfdf;
}

a.back_to_top:hover span {
    color: #555;
}

@media print, screen and (max-width: 580px) {
    .back_to_top {
        display: none !important;
    }
}



</style><a id="back_to_top" href="#" class="back_to_top"><span><i class="iconfont icon-xiangshang"></i></span>
</a>


<script>$(document).ready((function(_this) {
  return function() {
    var bt;
    bt = $('#back_to_top');
    if ($(document).width() > 480) {
      $(window).scroll(function() {
        var st;
        st = $(window).scrollTop();
        if (st > 30) {
          return bt.css('display', 'block');
        } else {
          return bt.css('display', 'none');
        }
      });
      return bt.click(function() {
        $('body,html').animate({
          scrollTop: 0
        }, 800);
        return false;
      });
    }
  };
})(this));
</script>

		<script data-no-instant>
    (function ($) {
        $.extend({
            adamsOverload: function () {
                $('.navigation:eq(0)').remove();
                $("").attr("rel" , "external");
                $("a[rel='external'],a[rel='external nofollow']").attr("target","_blank");
                $("a.vi").attr("rel" , "");
                $.viewImage({
                    'target'  : 'img',
                    'exclude' : '.vsmile-icons img,.gallery img',
                    'delay'   : 300
                });
                $.lately({
                    'target' : '.commentmetadata a,.infos time,.post-list time'
                });
                prettyPrint();
                
                $('ul.links li a').each(function(){
                    if($(this).parent().find('.bg').length==0){
                        $(this).parent().append('<!---<div class="bg" style="background-image:url(https://c3.glgoo.top/s2/favicons?domain='+$(this).attr("href")+')"></div>--->')
                    }
                });
            }
        });
    })(jQuery);
    jQuery.adamsOverload();
</script>

</body>
</html>
