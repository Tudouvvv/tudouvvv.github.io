<!DOCTYPE html>
<html>
  <head>
      
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Tudouvvv</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<meta name="description" content="äººç”Ÿè¿˜é•¿ï¼Œæ…¢æ…¢æ¥"/>
<meta name="keywords" content="äººç”Ÿè¿˜é•¿ï¼Œæ…¢æ…¢æ¥"/>

<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
<link rel="shortcut icon" href="https://tudouvvv.github.io//favicon.ico">

<link rel="stylesheet" href="https://tudouvvv.github.io//styles/main.css">

<!-- Modernizr JS -->
<script src="https://tudouvvv.github.io//media/scripts/_vendors/modernizr-2.6.2.min.js"></script>
<!-- FOR IE9 below -->
<!--[if lt IE 9]>
<scripts src="https://tudouvvv.github.io//media/scripts/_vendors/respond.min.js"></scripts>
<![endif]-->

<!-- Comment -->


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/tomorrow-night.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<link crossorigin="anonymous" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" href="https://lib.baomitu.com/font-awesome/5.8.1/css/all.min.css" rel="stylesheet">

  </head>
  <body>
  
<div id="fh5co-offcanvas">
    <a href="#!" class="fh5co-close-offcanvas js-fh5co-close-offcanvas">
        <span><i class="icon-cross3"></i> <span>Close</span></span>
    </a>
    <div class="fh5co-bio">
        <figure>
            <img src="https://tudouvvv.github.io//media/images/avatar.png" alt="Tudouvvv" class="img-responsive">
        </figure>
        <h3 class="heading">ABOUT ME</h3>
        <h2>Tudouvvv</h2>
        <p>äººç”Ÿè¿˜é•¿ï¼Œæ…¢æ…¢æ¥</p>
        <ul class="fh5co-social">
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
        </ul>
    </div>

    <div class="fh5co-menu">
        <div class="fh5co-box">
            <h3 class="heading">æœç´¢</h3>
            <form action="#">
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="è¾“å…¥å…³é”®å­—">
                </div>
            </form>
        </div>
        <div class="fh5co-box">
            <h3 class="heading">æ ‡ç­¾</h3>
            <ul>
                
                    <li><a href="https://tudouvvv.github.io//tag/leetcode">Leetcode</a></li>
                
                    <li><a href="https://tudouvvv.github.io//tag/python">Python</a></li>
                
                    <li><a href="https://tudouvvv.github.io//tag/keras">Keras</a></li>
                
                    <li><a href="https://tudouvvv.github.io//tag/mysql">Mysql</a></li>
                
                    <li><a href="https://tudouvvv.github.io//tag/code">Code</a></li>
                
                    <li><a href="https://tudouvvv.github.io//tag/Ejc-I2BJt">Life</a></li>
                
            </ul>
        </div>
    </div>
</div>

<header id="fh5co-header">
    <div class="container-fluid">
        <div class="row">
            <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
            <ul class="fh5co-social">
                
                    <li>
                        <a href="/"
                         >
                            é¦–é¡µ
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives"
                         >
                            å½’æ¡£
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags"
                         >
                            æ ‡ç­¾
                        </a>
                    </li>
                
                    <li>
                        <a href="/post/about"
                         >
                            å…³äº
                        </a>
                    </li>
                
            </ul>
            <div class="col-lg-12 col-md-12 text-center">
                <h1 id="fh5co-logo">
                    <a href="https://tudouvvv.github.io/">Tudouvvv</a>
                </h1>
            </div>
        </div>
    </div>
</header>


<!--  <a href="#" class="fh5co-post-prev"><span>ğŸ‘ˆ Prev</span></a>-->
<!--  <a href="#" class="fh5co-post-next"><span>Next ğŸ‘‰</span></a>-->

  <div class="container-fluid">
      <div class="row fh5co-post-entry single-entry">
          <article class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 col-sm-8 col-sm-offset-2 col-xs-12 col-xs-offset-0">
              <figure class="animate-box">
                  
                      <img src="https://raw.githubusercontent.com/Tudouvvv/Pic_path/master/2018-09-19-%E6%82%AC%E5%B4%96%E4%B8%8A%E7%9A%84%E9%87%91%E9%B1%BC%E5%A7%AC.jpg" alt="çŒ«çœ¼ç”µå½±TOP100çˆ¬å–" class="img-responsive">
                  
              </figure>
              <span class="fh5co-meta animate-box">
                  
                      <div class="tag-container">
                          
                              <a href="https://tudouvvv.github.io//tag/python" class="tag">Python, </a>
                          
                              <a href="https://tudouvvv.github.io//tag/code" class="tag">Code, </a>
                          
                      </div>
                  
              </span>
              <h2 class="fh5co-article-title animate-box">çŒ«çœ¼ç”µå½±TOP100çˆ¬å–</h2>
              <span class="fh5co-meta fh5co-date animate-box">2018-09-19</span>

              <div class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 col-xs-12 col-xs-offset-0 text-left content-article">
                  <div class="row">
                      <div class="col-md-12 animate-box post-content">
                          <p> <center>ä»Šå¤©åˆæ˜¯å……æ»¡å¸Œæœ›çš„ä¸€å¤©</center>
<!--more-->
<p>æ˜¨å¤©åˆšå¥½çœ‹äº†æ€ä¹ˆæŠŠçˆ¬ä¸‹æ¥çš„æ•°æ®å­˜å‚¨åˆ°excleä¸­ï¼Œæ‰€ä»¥ç”¨çŒ«çœ¼ç”µå½±TOP100æ‹¿æ¥ç»ƒæ‰‹ï¼Œå¯æƒœï¼Œæ•ˆæœä¸ä½³ï¼šæ„æƒ³çš„å¤ªè¿‡ç¾å¥½ï¼Œä»¥ä¸ºå…ˆæŠŠä¸€é¡µçš„å†™å¥½ï¼Œæœ€ååŠ å…¥å¤šé¡µçš„æœºåˆ¶å°±å¥½ã€‚<br>
ç„¶åå¼€å§‹å†™çˆ¬å–ä¸€é¡µå­˜å‚¨ç»“æœçš„ä»£ç ï¼Œå†™å®Œä¹‹åå†åŠ å…¥çˆ¬å–å¤šé¡µçš„ä»£ç ï¼Œç»“æœæ‚²å‰§äº†ï¼Œå‘ç°æ¯æ¬¡çˆ¬å®Œä¸€é¡µåå®ƒå­˜å‚¨ç»“æœçš„æ—¶å€™ä¼šæŠŠä¸Šæ¬¡çš„ç»“æœç»™è¦†ç›–æ‰Î£(ã£ Â°Ğ” Â°;)ã£ï¼Œæ‰¾åˆ°äº†è¿™ä¸ªé€»è¾‘é”™è¯¯çš„åœ°æ–¹ï¼Œç„¶åæ€è€ƒè§£å†³åŠæ³•ï¼Œçº ç»“äº†åŠå¤©ä¸çŸ¥é“æ€ä¹ˆä¿®æ”¹ï¼Œå‡†å¤‡ç¡è§‰çš„æ—¶å€™çµæœºä¸€åŠ¨~~ æˆ‘å¹²å˜›å­˜å‚¨çš„æ—¶å€™åªå­˜å‚¨ä¸€é¡µå•Šï¼Œæˆ‘ä¸ºå•¥ä¸è®¾ç½®ä¸€ä¸ªç©ºè¡¨ï¼Œç„¶åæŠŠæ¯ä¸€é¡µå¤„ç†å®Œçš„ä¿¡æ¯å…ˆå­˜å…¥æ€»è¡¨ï¼Œç„¶åå¯¹æ€»è¡¨å†è¿›è¡Œåˆ†æå­˜å‚¨ä¸å°±è§£å†³äº†å—ã€‚<br>
çœŸçš„æ˜¯å¤ªåƒµç¡¬äº†Î£(ã£ Â°Ğ” Â°;)ã£<img src="https://raw.githubusercontent.com/Tudouvvv/Pic_path/master/2018-09-19-%E6%9D%8E%E5%85%89%E6%B4%99%E8%A1%A8%E6%83%85--%E4%B8%8D%E8%A1%8C%E5%95%8A.gif" alt=""></p>
<p>å¥½å§ä¸‹é¢æ˜¯æ‰€æœ‰çš„æ“ä½œæµç¨‹ã€‚</p>
<h1 id="ç›®çš„çˆ¬å–çŒ«çœ¼ç”µå½±top100çš„ä¿¡æ¯">ç›®çš„ï¼šçˆ¬å–çŒ«çœ¼ç”µå½±TOP100çš„ä¿¡æ¯</h1>
<h1 id="åˆ†æè¿‡ç¨‹">åˆ†æè¿‡ç¨‹</h1>
<p>æ‰“å¼€çŒ«çœ¼ç”µå½±ï¼Œæ‰¾åˆ°	TOP100æ‰€åœ¨çš„ç½‘é¡µ(<code>http://maoyan.com/board/4</code>)<br>
<img src="https://raw.githubusercontent.com/Tudouvvv/Pic_path/master/2018-09-19-%E7%8C%AB%E7%9C%BCTOP100.png" alt="">)</p>
<p>æ¯ä¸€é¡µæœ‰åéƒ¨ç”µå½±ï¼Œä¸€å…±åé¡µï¼Œæ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ŒæŸ¥çœ‹æˆ‘ä»¬è¦çˆ¬å–çš„ä¿¡æ¯æœ‰å“ªäº›ï¼š</p>
<p><img src="https://raw.githubusercontent.com/Tudouvvv/Pic_path/master/2018-09-19-%E5%BC%80%E5%8F%91%E8%80%85%E5%B7%A5%E5%85%B7.png" alt=""><br>
OKï¼Œæˆ‘ä»¬éœ€è¦çˆ¬å–ç”µå½±æµ·æŠ¥é“¾æ¥ï¼Œç”µå½±åï¼ŒçŒ«çœ¼çš„IDç¼–å·ï¼Œä¸»æ¼”ï¼Œä¸Šæ˜ æ—¶é—´ï¼Œä»¥åŠè¯„åˆ†(æˆ‘è¦åæ§½ä¸€ä¸‹è¿™ä¸ªè¯„åˆ†ï¼Œ(â•¯â€µâ–¡â€²)â•¯ï¸µâ”»â”â”»ä¸ºå•¥è¦åˆ†æˆä¸¤éƒ¨åˆ†å•Šï¼Œå¥½å¥½çš„åœ¨ä¸€èµ·ä¸å¥½å—)ï¼Œæ¯ä¸ªç”µå½±çš„ä¿¡æ¯éƒ½åœ¨<code>&lt;dd&gt;&lt;/dd&gt;</code>è¿™ä¸ªèŠ‚ç‚¹ä¸­ï¼Œç„¶åå¼€å§‹å†™æ­£åˆ™è¡¨è¾¾å¼æ¥æå–æƒ³è¦çš„ä¿¡æ¯(æ˜æ˜å‰å‡ å¤©æ‰å¤ä¹ è¿‡æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸€åˆ°ç”¨çš„æ—¶å€™å°±åˆå¿˜è®°äº†ï¼Œåªèƒ½éœ€è¦ä»€ä¹ˆç„¶åå»ç¿»ç¬”è®°ï¼‰ï¼š</p>
<pre><code class="language-python">import requests
import re
import xlsxwriter as xlw
import time


class Movie():
    root_pattern = '&lt;dd&gt;([\s\S]*?)&lt;/dd&gt;' # æ¯éƒ¨ç”µå½±çš„æ‰€æœ‰ä¿¡æ¯
    pic_pattern = '&lt;img data-src=&quot;(.*?)@160w_220h_1e_1c' #æµ·æŠ¥ä¿¡æ¯
    name_pattern = 'alt=&quot;(.*?)&quot; class=&quot;board-img&quot;'  # åå­—ä¿¡æ¯
    id_pattern = 'data-val=&quot;{movieId:([\w]*?)}&quot;'   #ç¼–å·ä¿¡æ¯
    star_pattern = 'ä¸»æ¼”ï¼š([\s\S]*?)&lt;/p&gt;'     #ä¸»æ¼”ä¿¡æ¯
    date_pattern = '&lt;p class=&quot;releasetime&quot;&gt;ä¸Šæ˜ æ—¶é—´ï¼š([\s\S]*?)&lt;/p&gt;' #æ—¶é—´ä¿¡æ¯
    score1_pattern = '&lt;i class=&quot;integer&quot;&gt;(\d\.)&lt;/i&gt;'  #è¯„åˆ†ä¿¡æ¯
    score2_pattern = '&lt;i class=&quot;fraction&quot;&gt;(\d)&lt;/i&gt;'
</code></pre>
<p>å®šä¹‰äº†ä¸€ä¸ªç±»æ¥å¤ä¹ ä¸€ä¸‹ç±»çš„ç”¨æ³•ï¼Œè™½ç„¶å¹¶æ²¡æœ‰ä»€ä¹ˆä½œç”¨....è¿™éƒ¨åˆ†ä»£ç ä¸»è¦æ˜¯å®šä¹‰äº†çˆ¬å–å„é¡¹ä¿¡æ¯çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚</p>
<p>ç„¶åå…ˆçˆ¬å–æ•´ä¸ªç½‘é¡µçš„ä¿¡æ¯ï¼Œç”¨äº†<code>requests</code>è¿™ä¸ªåŒ…ï¼Œä¹Ÿæ˜¯ä¸ºäº†å¤ä¹ åˆšçœ‹åˆ°çš„çŸ¥è¯†:</p>
<pre><code class="language-python"> def __get(self, url):
        headers = {
                   'User-Agent': 'Mozilla/5.0(Macintosh;Intel Mac OS X 10_13_3) \
                   AppleWebKit/537.36(KHTML. like Gecko)\
                   Chrome/65.0.3325.162 Safari/536.36'
        }
        response = requests.get(url, headers=headers)
        htmls_source = response.text
        return htmls_source
</code></pre>
<p>è¿™é‡Œåªæ˜¯ç®€å•äº†ç”¨äº†<code>request</code>çš„<code>get</code>æ–¹æ³•æ¥è·å–ç½‘é¡µï¼Œæ·»åŠ äº†<code>headers</code>æ¥è¿›è¡Œä¼ªè£…ï¼Œä¸ç„¶å°±ä¼šæç¤º<code>å¾ˆæŠ±æ­‰ï¼Œæˆ‘ä»¬æ£€æµ‹åˆ°æ‚¨æ‰€åœ¨çš„ç½‘ç»œç¯å¢ƒå­˜åœ¨æ¶æ„è®¿é—®</code>çš„ä¿¡æ¯(å°´å°¬)......</p>
<p>å°†ç½‘é¡µçš„åŸå§‹ä¿¡æ¯å­˜å‚¨ä¸º<code>htmls_source</code>ï¼Œç„¶åå¯¹åŸå§‹ä¿¡æ¯è¿›è¡Œåˆ†æï¼Œä¹Ÿå°±æ˜¯åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥æå–æˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯ï¼š</p>
<pre><code class="language-python">def __analysis(self, htmls_source):
        htmls = re.findall(Movie.root_pattern, htmls_source)
        anchors = []
        for html in htmls:
            pic = re.findall(Movie.pic_pattern, html)
            name = re.findall(Movie.name_pattern, html)
            id = re.findall(Movie.id_pattern, html)[0]
            star = re.findall(Movie.star_pattern, html)
            date = re.findall(Movie.date_pattern, html)
            score1 = re.findall(Movie.score1_pattern, html)
            score2 = re.findall(Movie.score2_pattern, html)
            anchor = {'pic': pic, 'name': name, 'id': id, 'star': star,
                      'date': date, 'score1': score1, 'score2': score2}
            anchors.append(anchor)
        return anchors
</code></pre>
<p>é¦–å…ˆåˆ©ç”¨<code>findall</code>æ–¹æ³•å’Œå‰é¢å®šä¹‰çš„çˆ¶èŠ‚ç‚¹çš„æ­£åˆ™è¡¨è¾¾å¼<code>root_pattern</code>æ¥çˆ¬å–å•ä¸ªç”µå½±çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå­˜ä¸ºä¸€ä¸ªåˆ—è¡¨<code>htmls</code>ï¼Œæ¯ä¸ªç”µå½±çš„ä¿¡æ¯éƒ½æ˜¯è¯¥åˆ—è¡¨ä¸­çš„ä¸€ä¸ªå…ƒç´ <code>htmls[i]</code>ï¼Œç„¶åå®šä¹‰ä¸€ä¸ªç©ºè¡¨<code>anchors</code>å‡†å¤‡å­˜æ”¾çˆ¬å–çš„ä¿¡æ¯ï¼Œæ¥ç€å¯¹äºå•ä¸ªç”µå½±çš„ä¿¡æ¯<code>html</code>è¿›è¡Œæ­£åˆ™æå–ï¼Œæå–ä»¥åå­˜ä¸ºä¸€ä¸ªå­—å…¸å‘½åä¸º<code>anchor</code>å¹¶ä½¿ç”¨<code>append()</code>å¢åŠ å…ƒç´ çš„æ–¹æ³•å°†è¯¥å­—å…¸å­˜åˆ°æˆ‘ä»¬åˆšæ‰å®šä¹‰çš„ç©ºè¡¨<code>anchors</code>ä¸­ã€‚</p>
<p>å› ä¸ºæ­£åˆ™æå–ä»¥åçš„ä¿¡æ¯å¹¶ä¸æ•´é½ï¼Œæ¯”å¦‚è¯´<code>'star': ['å¼ å›½è£,å¼ ä¸°æ¯…,å·©ä¿\n ']</code>ä¸­å°±åŒ…æ‹¬äº†æ¢è¡Œç¬¦å’Œå¾ˆå¤šçš„ç©ºæ ¼ï¼Œæˆ‘ä»¬éœ€è¦å¤„ç†ä¸€ä¸‹ï¼š</p>
<pre><code class="language-python">    def __refine(self, anchors):
        return map(lambda anchor: {
            'pic': anchor['pic'][0], 'name': anchor['name'][0],
            'id': anchor['id'], 'star': anchor['star'][0].strip(),
            'date': anchor['date'][0],
            'score': anchor['score1'][0].strip() + anchor['score2'][0].strip()
        }, anchors)
</code></pre>
<p>å…ˆä½¿ç”¨<code>lambda</code>è¡¨è¾¾å¼å¯¹æ¯ä¸ªç”µå½±ä¿¡æ¯<code>anchor</code>ä¸­çš„å†—ä½™å…ƒç´ è¿›è¡Œå‰”é™¤ï¼Œç„¶åç”¨<code>map</code>è¿™ä¸ªç±»å¯¹<code>anchors</code>è¿™ä¸ªåˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ è¿›è¡ŒåŒæ ·çš„æ“ä½œï¼Œè¿”å›æˆ‘ä»¬æœ€ç»ˆæƒ³è¦çš„ä¿¡æ¯ã€‚</p>
<p>æ¥ç€æˆ‘è®¾ç½®äº†ä¸€ä¸ªå±•ç¤ºå‡½æ•°å°†ç»“æœå±•ç¤ºå‡ºæ¥ï¼š</p>
<pre><code class="language-python">    def __show(self, anchors):
        for anchor in anchors:
            print('pic:', anchor['pic'], 'name:', anchor['name'], 
                  'id:', anchor['id'], 'star:', anchor['star'],
                  'date:', anchor['date'], 'score:', anchor['score'])
</code></pre>
<p>ä¹Ÿå°±æ˜¯æ¯æ¬¡æ‰§è¡Œåä¼šæŠŠç»“æœæ‰“å°å‡ºæ¥ï¼Œåæ¥è§‰å¾—è¿˜æ˜¯å­˜å‚¨èµ·æ¥æ¯”è¾ƒå¥½ï¼Œå°±åˆå®šä¹‰äº†ä¸€ä¸ªå­˜å‚¨ä¸ºexcleçš„æ–¹æ³•ï¼Œç”¨äº†<code>xlsxwriter</code>è¿™ä¸ªåŒ…ï¼Œå…¶å®æ ¹æœ¬ä¸äº†è§£è¿™ä¸ªåŒ…çš„å…·ä½“æ“ä½œï¼Œæˆ‘ä¹Ÿæ˜¯çœ‹ç€åˆ«äººçš„ä»£ç ç…§è‘«èŠ¦ç”»ç“¢å­¦çš„ï¼š</p>
<pre><code>def __save_excle(self, anchors, filename):
        workbook = xlw.Workbook('%s.xlsx' % filename)
        # è¿™é‡Œé¦–å…ˆå¯¹è¿™ä¸ªWorkbookçš„ç±»è¿›è¡Œå®ä¾‹åŒ–ï¼Œåˆ›å»ºä¸€ä¸ªå·¥ä½œè–„ï¼Œç„¶åè®¾ç½®å­˜å‚¨çš„ä½ç½®ï¼Œæˆ‘è®¾ç½®çš„æ˜¯åŒçº§ç›®å½•

        sheet = workbook.add_worksheet()
        # æ¥ç€åˆ›å»ºå·¥ä½œè¡¨

        title = ['ç”µå½±æµ·æŠ¥é“¾æ¥', 'ç”µå½±å', 'çŒ«çœ¼IDç¼–å·', 'ä¸»æ¼”', 'ä¸Šæ˜ æ—¥æœŸ', 'è¯„åˆ†']
        for i in range(0, len(title)):
            sheet.write_string(0, i, title[i],
                               workbook.add_format({'bold': True}))
		#è®¾ç½®è¡¨çš„æ ‡é¢˜ï¼Œå¹¶ä¸”é‡‡ç”¨å­—ä½“åŠ ç²—

        sheet.set_column(0, 0, 50)
        sheet.set_column(1, 1, 20)
        sheet.set_column(2, 2, 10)
        sheet.set_column(3, 3, 45)
        sheet.set_column(4, 4, 20)
        # è®¾ç½®å•ç‹¬æ¯åˆ—çš„å•å…ƒæ ¼æ ·å¼ï¼Œè¿™é‡Œæˆ‘åªè®¾ç½®äº†å®½åº¦

        row, col = 1, 0
        # row--&gt;è¡Œåæ ‡   col--&gt;åˆ—åæ ‡  è®¾ç½®å†™å…¥çš„ä½ç½®

        for anchor in anchors:
            sheet.write_string(row, col, anchor['pic'])
            sheet.write_string(row, col + 1, anchor['name'])
            sheet.write_string(row, col + 2, anchor['id'])
            sheet.write_string(row, col + 3, anchor['star'])
            sheet.write_string(row, col + 4, anchor['date'])
            sheet.write_string(row, col + 5, anchor['score'])
            row += 1
         # å†™å…¥æˆ‘ä»¬çˆ¬å–çš„æ•°æ®ï¼Œç”±äºéƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æ˜¯ã€write_stringã€‘

        workbook.close()
        # å…³é—­å¹¶ä¿å­˜
</code></pre>
<p>ä¹Ÿæ˜¯ä¸€è¾¹å†™ï¼Œä¸€è¾¹çœ‹åˆ«äººæ€ä¹ˆå†™ï¼Œä¸€è¾¹çœ‹xlsxwriterçš„ä»‹ç»æ–‡æ¡£ï¼Œå†™å®Œä¹‹åå‘ç°å¯ä»¥ç”¨å“ˆå“ˆå“ˆï¼Œç„¶åå°±æ˜¯å®šä¹‰äº†çˆ¬å–å¤šé¡µçš„ä¸€ä¸ªæµç¨‹ï¼š</p>
<pre><code class="language-python">    def go(self):
        fin_achors = []
        for i in range(10):
            url = 'http://maoyan.com/board/4?offset={}'.format(i*10)
            htmls_source = Movie.__get(self, url)
            anchors = Movie.__analysis(self, htmls_source)
            anchors = Movie.__refine(self, anchors)
            time.sleep(1)
            fin_achors.extend(anchors)
        # Movie.__show(self, fin_achors)
        Movie.__save_excle(self, fin_achors, 'çŒ«çœ¼ç”µå½±TOP100')
</code></pre>
<p>æŸ¥çœ‹æ¯ä¸€é¡µçš„urlåå‘ç°è§„å¾‹(åæ§½æ–—é±¼ï¼Œæ¯ä¸€é¡µçš„urléƒ½ç›¸åŒï¼Œåªèƒ½ä»¥åå­¦äº†å…¶å®ƒä¸œè¥¿å†å°è¯•çˆ¬å–äº†)ï¼Œå®šä¹‰ä¸€ä¸ªæ€»çš„åˆ—è¡¨<code>fin_anchors</code>æ¥å­˜æ”¾çˆ¬å–åé¡µåçš„ä¿¡æ¯ï¼Œè®¾ç½®ä¸€ä¸ªforå¾ªç¯ï¼Œå°†æ¯ä¸€é¡µçš„çˆ¬å–ä¿¡æ¯åˆ©ç”¨<code>extend()</code>æ–¹æ³•å­˜æ”¾åˆ°æˆ‘ä»¬å®šä¹‰çš„æ€»è¡¨ä¸­ï¼Œå› ä¸ºå®³æ€•çˆ¬å–é€Ÿåº¦å¤ªå¿«å‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Œæ‰€ä»¥å¢åŠ äº†ä¸€ä¸ªå»¶æ—¶ç­‰å¾…<code>time.sleep(1)</code>ï¼Œç„¶åå¯¹æ€»è¡¨è¿›è¡Œæ‰“å°æˆ–è€…æ˜¯å­˜ä¸ºexcleçš„æ“ä½œã€‚</p>
<p>å…¶å®æœ€åèƒ½è§£å†³é—®é¢˜ä¹Ÿæ˜¯å› ä¸ºçœ‹åˆ°äº†<code>extend()</code>è¿™ä¸ªæ–¹æ³•ï¼Œå› ä¸ºå‡ºé”™çš„æ—¶å€™æœ‰å°è¯•å°†ä¸¤ä¸ªåˆ—è¡¨ç›¸åŠ çš„æ“ä½œï¼Œç»“æœåªæ˜¯åˆ—è¡¨ç›¸åŠ è€Œä¸æ˜¯å…ƒç´ çš„èšåˆï¼Œå‰é¢ä¹Ÿç”¨è¿‡<code>append()</code>è¿™ä¸ªæ–¹æ³•ï¼Œä¸Šç½‘æŸ¥äº†ä¸€ä¸‹ä¸¤è€…çš„åŒºåˆ«ï¼š</p>
<pre><code class="language-python">list.append(object) å‘åˆ—è¡¨ä¸­æ·»åŠ ä¸€ä¸ªå¯¹è±¡object
list.extend(sequence) æŠŠä¸€ä¸ªåºåˆ—seqçš„å†…å®¹æ·»åŠ åˆ°åˆ—è¡¨ä¸­

music_media = ['compact disc', '8-track tape', 'long playing record']
new_media = ['DVD Audio disc', 'Super Audio CD']
music_media.append(new_media)
print music_media
&gt;&gt;&gt;['compact disc', '8-track tape', 'long playing record', ['DVD Audio disc', 'Super Audio CD']]
ä½¿ç”¨appendçš„æ—¶å€™ï¼Œæ˜¯å°†new_mediaçœ‹ä½œä¸€ä¸ªå¯¹è±¡ï¼Œæ•´ä½“æ‰“åŒ…æ·»åŠ åˆ°music_mediaå¯¹è±¡ä¸­ã€‚

music_media = ['compact disc', '8-track tape', 'long playing record']
new_media = ['DVD Audio disc', 'Super Audio CD']
music_media.extend(new_media)
print music_media
&gt;&gt;&gt;['compact disc', '8-track tape', 'long playing record', 'DVD Audio disc', 'Super Audio CD']
ä½¿ç”¨extendçš„æ—¶å€™ï¼Œæ˜¯å°†new_mediaçœ‹ä½œä¸€ä¸ªåºåˆ—ï¼Œå°†è¿™ä¸ªåºåˆ—å’Œmusic_mediaåºåˆ—åˆå¹¶ï¼Œå¹¶æ”¾åœ¨å…¶åé¢ã€‚
</code></pre>
<h1 id="æœ€ç»ˆä»£ç ">æœ€ç»ˆä»£ç </h1>
<pre><code class="language-python">import requests
import re
import xlsxwriter as xlw
import time


class Movie():
    root_pattern = '&lt;dd&gt;([\s\S]*?)&lt;/dd&gt;'
    pic_pattern = '&lt;img data-src=&quot;(.*?)@160w_220h_1e_1c'
    name_pattern = 'alt=&quot;(.*?)&quot; class=&quot;board-img&quot;'
    id_pattern = 'data-val=&quot;{movieId:([\w]*?)}&quot;'
    star_pattern = 'ä¸»æ¼”ï¼š([\s\S]*?)&lt;/p&gt;'
    date_pattern = '&lt;p class=&quot;releasetime&quot;&gt;ä¸Šæ˜ æ—¶é—´ï¼š([\s\S]*?)&lt;/p&gt;'
    score1_pattern = '&lt;i class=&quot;integer&quot;&gt;(\d\.)&lt;/i&gt;'
    score2_pattern = '&lt;i class=&quot;fraction&quot;&gt;(\d)&lt;/i&gt;'
    
    def __get(self, url):
        headers = {
                   'User-Agent': 'Mozilla/5.0(Macintosh;Intel Mac OS X 10_13_3) \
                   AppleWebKit/537.36(KHTML. like Gecko)\
                   Chrome/65.0.3325.162 Safari/536.36'
        }
        response = requests.get(url, headers=headers)
        htmls_source = response.text
        return htmls_source

    def __analysis(self, htmls_source):
        htmls = re.findall(Movie.root_pattern, htmls_source)
        anchors = []
        for html in htmls:
            pic = re.findall(Movie.pic_pattern, html)
            name = re.findall(Movie.name_pattern, html)
            id = re.findall(Movie.id_pattern, html)[0]
            star = re.findall(Movie.star_pattern, html)
            date = re.findall(Movie.date_pattern, html)
            score1 = re.findall(Movie.score1_pattern, html)
            score2 = re.findall(Movie.score2_pattern, html)
            anchor = {'pic': pic, 'name': name, 'id': id, 'star': star,
                      'date': date, 'score1': score1, 'score2': score2}
            anchors.append(anchor)
        return anchors

    def __refine(self, anchors):
        return map(lambda anchor: {
            'pic': anchor['pic'][0], 'name': anchor['name'][0],
            'id': anchor['id'], 'star': anchor['star'][0].strip(),
            'date': anchor['date'][0],
            'score': anchor['score1'][0].strip() + anchor['score2'][0].strip()
        }, anchors)

    def __show(self, anchors):
        for anchor in anchors:
            print('pic:', anchor['pic'], 'name:', anchor['name'], 
                  'id:', anchor['id'], 'star:', anchor['star'],
                  'date:', anchor['date'], 'score:', anchor['score'])

    def __save_excle(self, anchors, filename):
        workbook = xlw.Workbook('%s.xlsx' % filename)
        sheet = workbook.add_worksheet()
        title = ['ç”µå½±æµ·æŠ¥é“¾æ¥', 'ç”µå½±å', 'çŒ«çœ¼IDç¼–å·', 'ä¸»æ¼”', 'ä¸Šæ˜ æ—¥æœŸ', 'è¯„åˆ†']
        for i in range(0, len(title)):
            sheet.write_string(0, i, title[i],
                               workbook.add_format({'bold': True}))
        sheet.set_column(0, 0, 50)
        sheet.set_column(1, 1, 20)
        sheet.set_column(2, 2, 10)
        sheet.set_column(3, 3, 45)
        sheet.set_column(4, 4, 20)
        
        row, col = 1, 0
        for anchor in anchors:
            sheet.write_string(row, col, anchor['pic'])
            sheet.write_string(row, col + 1, anchor['name'])
            sheet.write_string(row, col + 2, anchor['id'])
            sheet.write_string(row, col + 3, anchor['star'])
            sheet.write_string(row, col + 4, anchor['date'])
            sheet.write_string(row, col + 5, anchor['score'])
            row += 1
        workbook.close()

    def go(self):
        fin_achors = []
        for i in range(10):
            url = 'http://maoyan.com/board/4?offset={}'.format(i*10)
            htmls_source = Movie.__get(self, url)
            anchors = Movie.__analysis(self, htmls_source)
            anchors = Movie.__refine(self, anchors)
            time.sleep(1)
            fin_achors.extend(anchors)
        # Movie.__show(self, fin_achors)
        Movie.__save_excle(self, fin_achors, 'çŒ«çœ¼ç”µå½±TOP100')

movie = Movie()
movie.go()
</code></pre>
<h1 id="æœ€ç»ˆç»“æœ">æœ€ç»ˆç»“æœ</h1>
<h2 id="ç›®å½•ä¿¡æ¯">ç›®å½•ä¿¡æ¯</h2>
<p><img src="https://raw.githubusercontent.com/Tudouvvv/Pic_path/master/2018-09-19-%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%9C.png" alt=""><br>
æˆ‘è¿™é‡Œè®¾ç½®çš„æ˜¯åŒçº§ç›®å½•ï¼Œä¹Ÿå¯ä»¥åœ¨<code>__save_excle</code>ä¸­ä¿®æ”¹æˆåˆ«çš„ç›®å½•</p>
<h2 id="çˆ¬å–ä¿¡æ¯">çˆ¬å–ä¿¡æ¯</h2>
<p><img src="https://raw.githubusercontent.com/Tudouvvv/Pic_path/master/2018-09-19-%E7%88%AC%E5%8F%96%E7%BB%93%E6%9E%9C.png" alt=""></p>
<p>æ˜å¤©å°è¯•çˆ¬ä¸€ä¸‹è±†ç“£çš„TOP250å“ˆå“ˆå“ˆå“ˆå“ˆ<img src="https://raw.githubusercontent.com/Tudouvvv/Pic_path/master/2018-09-19-%E5%86%B2%E9%B8%AD.jpg" alt=""></p>
<h1 id="çˆ¬å–è±†ç“£åç»­">çˆ¬å–è±†ç“£åç»­ï¼š</h1>
<p>æœ¬æ¥ä»¥ä¸ºæ˜¯æ”¹å‡ ä¸ªå˜é‡çš„å€¼å°±å¯ä»¥äº† = = æ²¡æƒ³åˆ°è¿˜æ˜¯é‡åˆ°äº†ç‚¹å„¿é—®é¢˜<br>
<img src="https://raw.githubusercontent.com/Tudouvvv/Pic_path/master/2018-09-19-%E8%B1%86%E7%93%A3top250_%E8%82%96%E7%94%B3%E5%85%8B%E7%9A%84%E6%95%91%E8%B5%8E.png" alt=""><br>
åˆ†ææ­£åˆ™è¡¨è¾¾å¼çš„æ—¶å€™ä½¿ç”¨æ’åç¬¬ä¸€çš„<code>è‚–ç”³å…‹çš„æ•‘èµ</code>è¿›è¡Œåˆ†æçš„ï¼ŒæŒ‰ç…§æµç¨‹ï¼Œä¸€åˆ‡éƒ½å¾ˆæ­£å¸¸ï¼Œç„¶åæˆ‘å‡†å¤‡å‚¨å­˜è¿›excleçš„æ—¶å€™å‡ºç°äº†é—®é¢˜ï¼š<br>
<img src="https://raw.githubusercontent.com/Tudouvvv/Pic_path/master/2018-09-19-%E5%AD%98%E5%82%A8%E5%87%BA%E9%94%99.png" alt=""><br>
å™¢ï¼Œçœ‹æ¥æ˜¯å­˜å‚¨ä¸»æ¼”å§“åçš„æ—¶å€™å‡ºé”™äº†ï¼Œå‡ºé”™åŸå› å¹¶ä¸æ¸…æ¥šï¼Œç„¶åç™¾åº¦äº†ä¸€ä¸‹ï¼š</p>
<pre><code>Pythonä¸æ”¯æŒdictçš„keyä¸ºlistæˆ–dictç±»å‹ï¼Œå› ä¸ºlistå’Œdictç±»å‹æ˜¯unhashableï¼ˆä¸å¯å“ˆå¸Œï¼‰çš„ã€‚
</code></pre>
<p>è™½ç„¶ä¸çŸ¥é“å•¥å«ä¸å¯å“ˆå¸Œï¼Œä½†æ˜¯ä¹Ÿå·®ä¸å¤šæ¸…æ¥šäº†ï¼Œå¯èƒ½æ˜¯æˆ‘çš„<code>star</code>åçš„<code>key</code>å€¼æ²¡æœ‰è½¬æ¢è¿‡æ¥ï¼Œå»çœ‹äº†ä¸€ä¸‹ï¼Œæœç„¶ï¼š<br>
<img src="https://raw.githubusercontent.com/Tudouvvv/Pic_path/master/2018-09-19-star.png" alt=""><br>
æ•°æ®ç²¾ç‚¼çš„æ—¶å€™ï¼Œæˆ‘çš„<code>star</code>è¿˜æ˜¯åˆ—è¡¨ï¼Œåº”è¯¥å–åˆ—è¡¨é‡Œçš„å…ƒç´ çš„ï¼Œäºæ˜¯æˆ‘åœ¨åé¢åŠ å…¥äº†<code>[0]</code>,ä»¥ä¸ºè¿™ä¸‹å¯ä»¥æˆåŠŸäº†ï¼Œç»“æœåˆå‡ºé”™äº†ï¼š<br>
<img src="https://raw.githubusercontent.com/Tudouvvv/Pic_path/master/2018-09-19-list_out_of_range.png" alt=""><br>
<img src="https://raw.githubusercontent.com/Tudouvvv/Pic_path/master/2018-09-19-%E9%BB%91%E4%BA%BA%E9%97%AE%E5%8F%B7.jpg" alt=""><br>
è¿™åˆæ˜¯ä»€ä¹ˆé”™è¯¯ï¼Ÿï¼Ÿï¼Ÿåˆ—è¡¨è¶…å‡ºèŒƒå›´ï¼Ÿï¼Ÿï¼Ÿä»€ä¹ˆé¬¼ï¼Ÿï¼Ÿï¼Ÿäºæ˜¯æˆ‘åˆç™¾åº¦äº†ä¸€ä¸‹ï¼Œæ‰¾åˆ°äº†åŸå› ï¼š</p>
<pre><code>è¿™ä¸ªé”™è¯¯å‡ºç°å¤§çº¦æœ‰ä¸¤ç§æƒ…å†µï¼š 
ç¬¬1ç§å¯èƒ½æƒ…å†µ 
list[index]indexè¶…å‡ºèŒƒå›´

ç¬¬2ç§å¯èƒ½æƒ…å†µ 
listæ˜¯ä¸€ä¸ªç©ºçš„ æ²¡æœ‰ä¸€ä¸ªå…ƒç´  
è¿›è¡Œlist[0]å°±ä¼šå‡ºç°è¯¥é”™è¯¯
</code></pre>
<p>å—¯ï¼Ÿï¼Ÿï¼Ÿéš¾é“æ˜¯æˆ‘çš„<code>star</code>æ˜¯ç©ºçš„ï¼Ÿï¼Ÿï¼Ÿä¸å¯èƒ½å•Šï¼Œå½“æ—¶è¿˜æ‰“å°å‡º<code>anchors[0]</code>çœ‹è¿‡çš„å•Šï¼Œæœ‰å€¼å•Šï¼Œéš¾é“æ˜¯åˆ«çš„ç”µå½±ï¼Ÿï¼Ÿï¼Ÿäºæ˜¯æˆ‘æ‰“å¼€è±†ç“£TOP250ï¼Œçœ‹äº†ä¸€ä¸‹ï¼š<br>
<img src="https://raw.githubusercontent.com/Tudouvvv/Pic_path/master/2018-09-19-%E6%B2%A1%E6%9C%89star%E5%80%BC.png" alt=""><br>
æœç„¶ï¼Œæˆ‘å‘ç°æœ‰ä¸€éƒ¨ç”µå½±çš„<code>star</code>æœ‰ä¸€ç‚¹ä¸ä¸€æ ·ï¼Œè¿™ä»€ä¹ˆé¬¼å•Šï¼Œå¯¼æ¼”åå­—è¿™ä¹ˆé•¿ï¼Ÿï¼Ÿï¼Ÿä¸ºä»€ä¹ˆåé¢ä¸‰ä¸ªç‚¹...ä»¥åå°±æ²¡ä¸œè¥¿äº†å•Šï¼Œé™¤éä½ ç‚¹è¿›è¿™éƒ¨ç”µå½±çš„è¯¦æƒ…é¡µï¼Œå¦åˆ™ä½ æ˜¯çœ‹ä¸åˆ°ä¸»æ¼”å§“åçš„(æš‚æ—¶å‘ç°æ˜¯è¿™æ ·)ï¼Œæ‰€ä»¥åˆé‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼š</p>
<pre><code>çˆ¬è™«æœ‰çš„æ—¶å€™ä¼šåŒ¹é…åˆ°ç©ºå€¼ï¼Œè¿™ä¸ªæ—¶å€™åº”è¯¥æ€ä¹ˆå¤„ç†ï¼Ÿï¼Ÿ
</code></pre>
<p>æœ€åæˆ‘å†™äº†ä¸€ä¸ª<code>if</code>è¯­å¥æ¥åˆ¤æ–­å¦‚æœ<code>star</code>å€¼ä¸ºç©ºï¼Œé‚£ä¹ˆå¼ºè¡Œç»™<code>star</code>èµ‹å€¼ä¸º<code>None</code>ï¼Œé¢ï¼Œå¥½åƒæœ‰ç‚¹å„¿å¥‡æ€ªï¼Œåæ­£å…ˆè¿™æ ·å§ï¼š</p>
<pre><code class="language-python">star = re.findall(star_pattern, html)
    if star == []:
        star = 'None'
</code></pre>
<p>å°±è¿™æ ·ï¼ŒæˆåŠŸçš„è§£å†³äº†é—®é¢˜ï¼Œå¹¶ä¸”è¿™ä¸€æ¬¡æˆ‘æ˜¯æŠŠæ¯ä¸ªéƒ¨åˆ†çš„å‡½æ•°æ‹†ä¸ªä¸€ä¸ªä¸€ä¸ªæ¨¡å—æ¥å†™çš„:<br>
<img src="https://raw.githubusercontent.com/Tudouvvv/Pic_path/master/2018-09-19-%E6%A8%A1%E5%9D%97.png" alt=""></p>
<p>æœ€åæˆåŠŸè·å¾—äº†è±†ç“£TOP250çš„è¯¦ç»†åå•ï¼š</p>
<p><img src="https://raw.githubusercontent.com/Tudouvvv/Pic_path/master/2018-09-19-top250.png" alt=""></p>
 </p>
                      </div>
                  </div>

                  <div class="row">
                      <div class="col-md-12 animate-box">
                          
                              <div class="next-post">
                                  <div class="next">ä¸‹ä¸€ç¯‡</div>
                                  <a href="https://tudouvvv.github.io//post/Pythonå­¦ä¹ ä¹‹è·¯">
                                      <h3 class="post-title">
                                          Pythonå­¦ä¹ æ—¥è®°
                                      </h3>
                                  </a>
                              </div>
                          
                      </div>
                  </div>

                  <div class="row">
                      <div class="col-md-12 animate-box">
                          
                      </div>
                  </div>
              </div>

          </article>
      </div>
  </div>

    
<footer id="fh5co-footer">
  <p>Powered by <a href="https://github.com/tudouvvv" target="_blank">Tudouvvv</a></p>
</footer>


    
<!-- jQuery -->
<script src="https://tudouvvv.github.io//media/scripts/_vendors/jquery.min.js"></script>
<!-- jQuery Easing -->
<script src="https://tudouvvv.github.io//media/scripts/_vendors/jquery.easing.1.3.js"></script>
<!-- Bootstrap -->
<script src="https://tudouvvv.github.io//media/scripts/_vendors/bootstrap.min.js"></script>
<!-- Waypoints -->
<script src="https://tudouvvv.github.io//media/scripts/_vendors/jquery.waypoints.min.js"></script>
<!-- Main JS -->
<script src="https://tudouvvv.github.io//media/scripts/_vendors/main.js"></script>
<!-- Md5 Min JS -->
<script src="https://tudouvvv.github.io//media/scripts/_vendors/md5.min.js"></script>

<script type="application/javascript">
    hljs.initHighlightingOnLoad();
</script>




  </body>
</html>
